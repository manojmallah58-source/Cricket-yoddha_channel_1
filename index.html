<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8">
    <title>Cricket Yoddha Live</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
    <style>
        body { margin: 0; background: #000; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .container { width: 100%; max-width: 1000px; aspect-ratio: 16/9; position: relative; }
        video { width: 100%; height: 100%; }
        .watermark { position: absolute; top: 15px; right: 15px; width: 50px; z-index: 10; opacity: 0.8; pointer-events: none; }
    </style>
</head>
<body>

<div class="container">
    <img src="https://i.ibb.co/4RvCpCsM/Qdqj-WDqj-QOOb5vb-K8f4wf-Q.png" class="watermark">
    <video id="player" playsinline controls crossorigin="anonymous"></video>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
let shakaInstance;
let playerUI;

async function init() {
    const video = document.getElementById('player');
    shaka.polyfill.installAll();

    if (!shaka.Player.isBrowserSupported()) {
        alert("Aapka browser support nahi kar raha!");
        return;
    }

    shakaInstance = new shaka.Player(video);

    // Error Handling
    shakaInstance.addEventListener('error', (event) => {
        console.error('Shaka Error:', event.detail);
        if(event.detail.code == 1001) alert("CORS Error: Stream block ho gayi hai.");
    });

    shakaInstance.configure({
        drm: {
            clearKeys: {
                'ae7076b647133606b704d33e4cef5134': '810251515584cf71216d9a2d1ebf04bb'
            }
        },
        streaming: {
            bufferingGoal: 30,
            jumpLargeGaps: true
        }
    });

    const url = 'https://livem-d-01-icc-we.akamaized.net/variant/v1/dai-event-prd-pal-west/vcg-01-d/DASH_DASH/Live/channel(vcg-01-ch-hd-05)/manifest.mpd?vcfilter=44951f97-10ec-427f-a95a-a2ecf57e9a41';

    try {
        await shakaInstance.load(url);
        setupUI();
    } catch (e) {
        console.error("Load Failed", e);
    }
}

function setupUI() {
    const video = document.getElementById('player');
    const tracks = shakaInstance.getVariantTracks();
    const levels = [...new Set(tracks.map(t => t.height))].filter(h => h).sort((a,b) => b-a);

    playerUI = new Plyr(video, {
        settings: ['quality', 'speed'],
        quality: {
            options: [0, ...levels],
            onChange: (h) => {
                if(h === 0) shakaInstance.configure({abr:{enabled:true}});
                else {
                    shakaInstance.configure({abr:{enabled:false}});
                    shakaInstance.selectVariantTrack(tracks.find(t => t.height === h), true);
                }
            }
        }
    });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
